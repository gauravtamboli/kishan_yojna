<!-- <ion-split-pane contentId="main-content" when="(min-width: 768px)"> -->
<ion-split-pane contentId="main-content" when="md">

  <!-- <ion-menu class="custom-menu" side="start" content-id="main-content"> -->
  <ion-menu menuId="ro-menu" class="custom-menu" side="start" contentId="main-content">

    <ion-header class="ion-header-class-for-menu dashboard-menu-header">
      <div class="bg"></div>

      <ion-item lines="none">
        <ion-avatar slot="start">
          <img src="assets/img/app_logo.png" />
        </ion-avatar>
        <ion-label class="ion-label" style=" text-wrap: nowrap;">
          {{ getTranslation('app_name')}}
          <p class="p">

            <ion-text style="font-size: small ;"> ({{ getTranslation('state_name')}}) </ion-text>
          </p>

        </ion-label>
      </ion-item>
    </ion-header>

    <ion-content>
      <ion-list>
        <ion-menu-toggle auto-hide="false">
          <ion-item *ngFor="let page of pages; let i = index" class="no-gap-item" lines="none">
            <ng-container *ngIf="page.is_submenu; else noSubMenu">
              <ion-text class="responsive-menu-title" style="width: 100%; margin-left: 10px"
                (click)="onMenuItemClick(page)">{{ page.title }}</ion-text>
            </ng-container>


            <ng-template #noSubMenu>
              <ng-container>
                <ion-text class="responsive-menu-title" style="font-weight: 900; width: 100%; margin-top: 5px"
                  (click)="onMenuItemClick(page)">
                  {{ page.title }}
                </ion-text>
              </ng-container>
            </ng-template>
          </ion-item>
        </ion-menu-toggle>
      </ion-list>
    </ion-content>
    <!-- <ion-content>
      <ion-list>
        <ion-menu-toggle *ngFor="let page of pages; let i = index">
          <ion-item class="no-gap-item" lines="none">
            <ion-text class="responsive-menu-title" style="width: 100%; margin-left: 10px"
              (click)="onMenuItemClick(page)">
              {{ page.title }}
            </ion-text>
          </ion-item>
        </ion-menu-toggle>
      </ion-list>

    </ion-content> -->
  </ion-menu>

  <div class="ion-page" id="main-content">
    <ion-header>
      <ion-toolbar color="primary" style="padding: 8px;">

        <!-- START : MENU BUTTON -->
        <ion-buttons slot="start">
          <!-- <ion-menu-button class="icon-btn-menu"></ion-menu-button> -->
          <ion-menu-button menu="ro-menu" class="icon-btn-menu"></ion-menu-button>

        </ion-buttons>

        <!-- CENTER : OFFICER NAME -->
        <ion-label class="header-label ion-text-center">
          <span class="officer-name">
            {{ getLoginedOfficerName() }}
          </span>

          <span class="session-text">
            (Session : {{curent_session }})
          </span>
        </ion-label>


        <!-- END : DROPDOWN -->

        <ion-buttons slot="end">
          <ion-button fill="clear" class="icon-btn-options" (click)="openUserMenu($event)">
            <ion-icon name="options-outline"></ion-icon>
          </ion-button>
        </ion-buttons>

        <ion-popover [event]="popoverEvent" side="bottom" alignment="end" dismiss-on-select="true"
          [isOpen]="isUserMenuOpen" (didDismiss)="isUserMenuOpen = false">

          <ng-template>
            <ion-list>
              <ion-item button (click)="onYearSelect(2)">द्वितीय वर्ष</ion-item>
              <ion-item button (click)="onYearSelect(3)">तृतीय वर्ष</ion-item>
              <ion-item button (click)="goToProfile()">Profile</ion-item>
              <ion-item button (click)="changePassword()">Change Password</ion-item>
              <ion-item button color="danger" (click)="logoutFunction()">Logout <ion-icon slot="start"
                  name="log-out-outline"></ion-icon> </ion-item>
            </ion-list>
          </ng-template>

        </ion-popover>



      </ion-toolbar>
    </ion-header>


    <ion-content>
      <ion-loading cssClass="custom-loading" [isOpen]="isLoading" [message]="loadingMessage"
        [backdropDismiss]="false"></ion-loading>
      <ion-grid>
        <ion-row>
          <ion-col size="12" size-lg="12">
            <ion-grid>
              <ion-row style="
                  display: flex;
                  flex-direction: row;
                  justify-content: center;
                ">


                <!-- कुल आवेदन -->
                <ion-col size="6" size-lg="3">
                  <ion-card class="custom-card" (click)="getListOfAwedanAfterClickOnBoxes(1)">
                    <ion-grid class="ion-my-grid"
                      style="background: linear-gradient(135deg, #198edb 0%, #1565c0 100%);">
                      <ion-row>
                        <ion-col size="12" class="ion-text-center">
                          <ion-label class="responsive-label-count label-divider">
                            <span class="label-text">कुल आवेदन</span>
                            <span class="label-count">{{ totalAwedan }}</span>
                          </ion-label>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-card>
                </ion-col>

                <!-- संपादन लंबित -->
                <ion-col size="6" size-lg="3">
                  <ion-card class="custom-card" (click)="getListOfAwedanAfterClickOnBoxes(2)">
                    <ion-grid class="ion-my-grid"
                      style="background: linear-gradient(135deg, #bcf420 0%, #319d27 100%);">
                      <ion-row>
                        <ion-col size="12" class="ion-text-center">
                          <ion-label class="responsive-label-count label-divider">
                            <span class="label-text">संपादन लंबित</span>
                            <span class="label-count">{{ totalEditPending }}</span>
                          </ion-label>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-card>
                </ion-col>

                <!-- स्वीकृत -->
                <ion-col size="6" size-lg="3">
                  <ion-card class="custom-card" (click)="getListOfAwedanAfterClickOnBoxes(6)">
                    <ion-grid class="ion-my-grid"
                      style="background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);">
                      <ion-row>
                        <ion-col size="12" class="ion-text-center">
                          <ion-label class="responsive-label-count label-divider">
                            <span class="label-text">स्वीकृत</span>
                            <span class="label-count">{{ totalApproved }}</span>
                          </ion-label>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-card>
                </ion-col>

                <!-- अस्वीकृत -->
                <ion-col size="6" size-lg="3">
                  <ion-card class="custom-card" (click)="getListOfAwedanAfterClickOnBoxes(7)">
                    <ion-grid class="ion-my-grid"
                      style="background: linear-gradient(135deg, #aa0f0f 0%, #8de22c 100%);">
                      <ion-row>
                        <ion-col size="12" class="ion-text-center">
                          <ion-label class="responsive-label-count label-divider">
                            <span class="label-text">अस्वीकृत</span>
                            <span class="label-count">{{ totalApproved }}</span>
                          </ion-label>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-card>
                </ion-col>



                <!-- परिक्षेत्र अधिकारी स्तर पर लंबित -->
                <ion-col size="12" size-lg="4">
                  <ion-card class="custom-card" (click)="getListOfAwedanAfterClickOnBoxes(3)">
                    <ion-grid class="ion-my-grid"
                      style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);">
                      <ion-row>
                        <ion-col size="12" class="ion-text-center">
                          <ion-label class="responsive-label-count label-divider">
                            <span class="label-text">परिक्षेत्र अधिकारी स्तर पर लंबित</span>
                            <span class="label-count">{{ totalROPending }}</span>
                          </ion-label>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-card>
                </ion-col>

                <!-- उपवनमंडलाधिकारी स्तर पर लंबित -->
                <ion-col size="12" size-lg="4">
                  <ion-card class="custom-card" (click)="getListOfAwedanAfterClickOnBoxes(4)">
                    <ion-grid class="ion-my-grid"
                      style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);">
                      <ion-row>
                        <ion-col size="12" class="ion-text-center">
                          <ion-label class="responsive-label-count label-divider">
                            <span class="label-text">उपवनमंडलाधिकारी स्तर पर लंबित</span>
                            <span class="label-count">{{ totalSDOPending }}</span>
                          </ion-label>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-card>
                </ion-col>

                <!-- वनमंडलाधिकारी स्तर पर लंबित -->
                <ion-col size="12" size-lg="4">
                  <ion-card class="custom-card" (click)="getListOfAwedanAfterClickOnBoxes(5)">
                    <ion-grid class="ion-my-grid"
                      style="background: linear-gradient(135deg, #673ab7 0%, #512da8 100%);">
                      <ion-row>
                        <ion-col size="12" class="ion-text-center">
                          <ion-label class="responsive-label-count label-divider">
                            <span class="label-text">वनमंडलाधिकारी स्तर पर लंबित</span>
                            <span class="label-count">{{ totalDFOPending }}</span>
                          </ion-label>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-card>
                </ion-col>


              </ion-row>
            </ion-grid>

            <hr style="background-color: black; height: 1px" />
          </ion-col>
        </ion-row>
      </ion-grid>

      <div class="ion-padding">
        <ion-row class="mb-3 align-items-center">
          <ion-col size="12" size-lg="6">
            <ion-input class="custom-input shadow-sm" [(ngModel)]="searchMobile" fill="outline"
              placeholder="मोबाइल नंबर / हितग्राही नाम / पिता का नाम" (ionInput)="onSearch($event)"
              (keyup.enter)="onEnter()">
            </ion-input>
          </ion-col>

          <ion-col size="6" size-lg="6" class="text-end">
            <ion-button color="success" (click)="export()" style="height: 4px;">
              <ion-icon name="download-outline" slot="start"></ion-icon>
              Export To Excel
            </ion-button>
          </ion-col>
        </ion-row>

        <div class="table-responsive shadow-sm rounded-4">
          <p-table [value]="filteredAwedans" [paginator]="false" [responsiveLayout]="'scroll'"
            class="bootstrap-table p-datatable-striped p-datatable-hoverable-rows custom-dashboard-table"
            id="dashboard_table">
            <!-- Header -->
            <ng-template pTemplate="header">
              <tr>
                <th>#</th>
                <th>आवेदन नंबर</th>
                <th>हितग्राही का नाम</th>
                <th>पिता का नाम</th>
                <th>वृत्त (वन मंडल)</th>
                <th>आवेदन की स्थिति</th>
                <th class="text-center">क्रियाएँ</th>
              </tr>
            </ng-template>

            <!-- Body -->
            <ng-template pTemplate="body" let-item let-i="rowIndex">
              <tr>
                <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
                <td>{{ item.application_number }}</td>
                <td>
                  <div class="beneficiary-cell">
                    <strong>{{ item.hitgrahi_name }}</strong>
                    <div class="text-muted small">{{ item.mobile_no }}</div>
                  </div>
                </td>
                <td>{{ item.father_name }}</td>
                <td>{{ item.circle_name }} ({{ item.division_name }})</td>
                <td>
                  <span class="status-badge" [ngClass]="{
              'status-approved': item.awedan_status == 6,
              'status-pending': item.awedan_status == 2,
              'status-draft': item.awedan_status < 1,
              'status-rejected': item.awedan_status == 3
            }">
                    {{ getStatusText(item) }}
                  </span>
                </td>

                <td class="text-center">
                  <div class="action-buttons">
                    <ion-button fill="outline" color="primary" size="small" (click)="viewApplication(item)">
                      विवरण देखें
                    </ion-button>

                    <ion-button *ngIf="item.awedan_status < 1" fill="outline" color="warning" size="small"
                      (click)="editAwedan(item)">
                      संपादित करें
                    </ion-button>

                    <ion-button *ngIf="canViewEstimate(item)" fill="solid" color="tertiary" size="small"
                      (click)="generateEstimateDynamic(item)">
                      {{ item.awedan_status < 2 ? 'प्राक्कलन बनाएं ' : 'प्राक्कलन देखें' }} </ion-button>
                  </div>
                </td>
              </tr>
            </ng-template>

          </p-table>
        </div>

        <!-- Custom Pagination -->
        <div *ngIf="totalPages > 1" class="pagination-container mt-3">
          <ion-row class="align-items-center justify-content-center">
            <ion-col size="auto">
              <ion-button [disabled]="currentPage === 1" (click)="goToPreviousPage()" fill="outline" size="small">
                <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
                पिछला
              </ion-button>
            </ion-col>

            <ion-col size="auto">
              <div class="page-numbers">
                <ion-button *ngFor="let page of getPageNumbers()" [color]="page === currentPage ? 'primary' : 'medium'"
                  [fill]="page === currentPage ? 'solid' : 'outline'" size="small" (click)="goToPage(page)"
                  class="page-btn">
                  {{ page }}
                </ion-button>
              </div>
            </ion-col>

            <ion-col size="auto">
              <ion-button [disabled]="currentPage === totalPages" (click)="goToNextPage()" fill="outline" size="small">
                अगला
                <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
              </ion-button>
            </ion-col>

            <ion-col size="auto" class="text-muted">
              <small>पृष्ठ {{ currentPage }} / {{ totalPages }} (कुल {{ totalRecords }} रिकॉर्ड)</small>
            </ion-col>
          </ion-row>
        </div>

        <!-- No record message -->
        <div *ngIf="isNoRecordFound" class="no-record-found-box">
          <ion-label>कोई आवेदन प्राप्त नहीं</ion-label>
        </div>


      </div>

    </ion-content>
  </div>
</ion-split-pane>